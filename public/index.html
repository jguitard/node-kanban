<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=1920, height=1080, initial-scale=1" />
		<title>node-kanban</title>
		<script src="bower_components/angular/angular.js"></script>
		<script src="bower_components/angular-resource/angular-resource.min.js"></script>
		
		<link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
				
		<link rel="stylesheet" href="stylesheets/style.css">
		
		<script src="javascripts/app.js"></script>
		<script src="javascripts/controllers/BoardController.js"></script>
	</head>
	<body ng-app="NodeKanbanApp">
		<nav class="navbar navbar-default" role="navigation">
			<div class="navbar-header">
				<div class="navbar-brand navbar-left">
					NodeKanban
				</div>
			</div>
			<div class="navbar-brand">
				Tablero: Desarrollo
			</div>
			<div class="navbar-brand navbar-right">
				Dirección IP: 123.234.255.23
			</div>
		</nav>
		<div ng-controller="BoardController" class="table-responsive">
			<table class="table table-condensed table-bordered">
				<thead>
					<tr>
						<th rowspan="2" colspan="2">Tareas pendientes</th>
						<th ng-repeat="stage in stages" colspan="{{ ((stage.wip.pre > 0)? 1 : 0) + ((stage.wip.task > 0)? 1 : 0) + ((stage.wip.post > 0)? 1 : 0) }}" rowspan="{{ ((((stage.wip.pre > 0)? 1 : 0) + ((stage.wip.task > 0)? 1 : 0) + ((stage.wip.post > 0)? 1 : 0)) > 1)? 1 : 2 }}">{{ stage.name }}</th>
						<th rowspan="2" colspan="2">Finalizado</th>
					</tr>
					<tr>
						<th ng-repeat-start="stage in stages" ng-show="stage.wip.pre > 0">En espera <span class="badge pull-right">{{ stage.wip.pre }}</span></th>
						<th ng-show="stage.wip.task > 0">En progreso <span class="badge pull-right">{{ stage.wip.task }}</span></th>
						<th ng-show="stage.wip.post > 0" ng-repeat-end>Hecho <span class="badge pull-right">{{ stage.wip.post }}</span></th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="swimlane in swimlanes">
						<th>{{ swimlane.name }}</th>
						<td>
							<div class="panel cos-{{ task.cos }}" ng-repeat="task in tasks" ng-if="task.swimlane == swimlane.name && task.stage == '' && task.wip == 'pre'">
								<div class="panel-heading">
									<strong>#{{ task.id }}</strong> {{task.name}}
								</div>
								<div class="panel-body">
									<div ng-repeat="item in task.items"><span class="glyphicon" ng-class="{ 'glyphicon-ok': item.done, 'glyphicon-minus': !item.done }"></span> {{ item.name }}</div>
								</div>
								<div class="panel-footer">
									<img ng-repeat="user in task.users" ng-if="$index + 1 <= 3" class="img-rounded" src="{{ user.picture }}" alt="{{ user.name }}" width="32" height="32">
									<span ng-if="task.users.length > 3">y {{ task.users.length - 3 }} más...</span>
								</div>
							</div>
						</td>
						<td ng-repeat-start="stage in stages" ng-show="stage.wip.pre > 0" ng-style="{ 'visibility': ( ((swimlane.only_stages == undefined || (swimlane.only_stages != undefined && swimlane.only_stages.pre.indexOf(stage.name) != -1) ))? 'visible' : 'hidden' ) }">
							<div class="panel cos-{{ task.cos }}" ng-repeat="task in tasks" ng-if="task.swimlane == swimlane.name && task.stage == stage.name && task.wip == 'pre'">
								<div class="panel-heading">
									<strong>#{{ task.id }}</strong> {{task.name}}
								</div>
								<div class="panel-body">
									<div ng-repeat="item in task.items"><span class="glyphicon" ng-class="{ 'glyphicon-ok': item.done, 'glyphicon-minus': !item.done }"></span> {{ item.name }}</div>
								</div>
								<div class="panel-footer">
									<img ng-repeat="user in task.users" ng-if="$index + 1 <= 3" class="img-rounded" src="{{ user.picture }}" alt="{{ user.name }}" width="32" height="32">
									<span ng-if="task.users.length > 3">y {{ task.users.length - 3 }} más...</span>
								</div>
							</div>
						</td>
						<td ng-show="stage.wip.task > 0" ng-style="{ 'visibility': ( ((swimlane.only_stages == undefined || (swimlane.only_stages != undefined && swimlane.only_stages.task.indexOf(stage.name) != -1) ))? 'visible' : 'hidden' ) }">
							<div class="panel cos-{{ task.cos }}" ng-repeat="task in tasks" ng-if="task.swimlane == swimlane.name && task.stage == stage.name && task.wip == 'task'">
								<div class="panel-heading">
									<strong>#{{ task.id }}</strong> {{task.name}}
								</div>
								<div class="panel-body">
									<div ng-repeat="item in task.items"><span class="glyphicon" ng-class="{ 'glyphicon-ok': item.done, 'glyphicon-minus': !item.done }"></span> {{ item.name }}</div>
								</div>
								<div class="panel-footer">
									<img ng-repeat="user in task.users" ng-if="$index + 1 <= 3" class="img-rounded" src="{{ user.picture }}" alt="{{ user.name }}" width="32" height="32">
									<span ng-if="task.users.length > 3">y {{ task.users.length - 3 }} más...</span>
								</div>
							</div>
						</td>
						<td ng-show="stage.wip.post > 0" ng-style="{ 'visibility': ( ((swimlane.only_stages == undefined || (swimlane.only_stages != undefined && swimlane.only_stages.post.indexOf(stage.name) != -1) ))? 'visible' : 'hidden' ) }" ng-repeat-end>
							<div class="panel cos-{{ task.cos }}" ng-repeat="task in tasks" ng-if="task.swimlane == swimlane.name && task.stage == stage.name && task.wip == 'post'">
								<div class="panel-heading">
									<strong>#{{ task.id }}</strong> {{task.name}}
								</div>
								<div class="panel-body">
									<div ng-repeat="item in task.items"><span class="glyphicon" ng-class="{ 'glyphicon-ok': item.done, 'glyphicon-minus': !item.done }"></span> {{ item.name }}</div>
								</div>
								<div class="panel-footer">
									<img ng-repeat="user in task.users" ng-if="$index + 1 <= 3" class="img-rounded" src="{{ user.picture }}" alt="{{ user.name }}" width="32" height="32">
									<span ng-if="task.users.length > 3">y {{ task.users.length - 3 }} más...</span>
								</div>
							</div>
						</td>
						<td>
							<div class="panel cos-{{ task.cos }}" ng-repeat="task in tasks" ng-if="task.swimlane == swimlane.name && task.stage == '' && task.wip == 'post'">
								<div class="panel-heading">
									<strong>#{{ task.id }}</strong> {{task.name}}
								</div>
								<div class="panel-body">
									<div ng-repeat="item in task.items"><span class="glyphicon" ng-class="{ 'glyphicon-ok': item.done, 'glyphicon-minus': !item.done }"></span> {{ item.name }}</div>
								</div>
								<div class="panel-footer">
									<img ng-repeat="user in task.users" ng-if="$index + 1 <= 3" class="img-rounded" src="{{ user.picture }}" alt="{{ user.name }}" width="32" height="32">
									<span ng-if="task.users.length > 3">y {{ task.users.length - 3 }} más...</span>
								</div>
							</div>
						</td>
					</tr>
				</tbody>
			</table>
			<div class="pull-bottom pull-right cos">
				<strong>Clases de servicio</strong>
				<span class="cos-{{ class_of_service.priority }}" ng-repeat="class_of_service in classes_of_service"><span class="glyphicon glyphicon-tag"></span> {{ class_of_service.name }}</span>
			</div>
		</div>
		<script src="bower_components/jquery/dist/jquery.min.js"></script>
		<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
	</body>
</html>